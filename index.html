<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="public/style.css">
    <link rel="icon" type="image/x-icon" href="assets/GoalGarden_logo.png">
    <title>About</title>
</head>

<body>
    <nav class="navigation-bar">
        <section class="navigation-bar-left">
            <a href="" class="home-page">
                <img src="../assets/GoalGarden_logo.png" alt="Logo" style="height:2.5vw; margin: auto;">
                <h1 class="m-auto">GoalGarden</h1>
            </a>

            <a href="../pages/about.html" class="about-page">
                <h1 class="m-auto">About</h1>
            </a>
        </section>

        <section class="navigation-bar-right">
            <a href="../pages/settings.html" class="settings-page">
                <h1 class="m-auto">Settings</h1>
            </a>
            <a href="../index.html" class="profile-page">
                <h1 class="m-auto">Profile</h1>
            </a>
        </section>
    </nav>

    <section class="login-card-container">
        <h1 class="login-title">Log in / Register</h1>
        <form class="login-form">
            <div class="icon-input">
                <img src="../assets/username-icon.webp" alt="Username Icon" class="input-icon">
                <input type="text" id="username" name="username" placeholder="Username" required>
            </div>
            <div class="icon-input">
                <img src="../assets/password-icon.png" alt="Password Icon" class="input-icon">
                <input type="password" id="password" name="password" placeholder="Password" required>
            </div>

            <button type="submit" class="login-button">Login</button>
        </form>
    </section>
</body>
<!--script for submission, feel free to remove this when you have something substantial-->
<script>
    const loginForm = document.querySelector('.login-form');
    const loginFormInputs = loginForm.querySelectorAll('input');

    function validateInput(input) {
        var text = input.value;
        if(input.type === 'password') {
            let errors = [];
            
            if(text.length < 8 || text.length > 20) {
                errors.push("Must be between 8 and 20 characters long");
            }

            if(!/[A-Z]/.test(text)) {
                errors.push("Must contain at least one uppercase letter");
            }

            if(!/[a-z]/.test(text)) {
                errors.push("Must contain at least one lowercase letter");
            }

            if(!/[0-9]/.test(text)) {
                errors.push("Must contain at least one digit");
            }

            if(!/['!@#$%^&*(),.?":{}|<>]/.test(text)) {
                errors.push("Must contain at least one special character");
            }

            if(errors.length > 0) {
                input.setCustomValidity("Your password does not meet the following criteria:\n• " + errors.join("\n• "));
                return false;
            } else {
                input.setCustomValidity("");
                return true;
            }
        } else if(input.type === 'text') {
            if(text.length === 0) {
                input.setCustomValidity("Username is required");
                return false;
            } else {
                input.setCustomValidity("");
                return true;
            }
        } else {
            return input.checkValidity();
        }
    }

    function saveLoginData(username, password) {
        console.log("Saving login data:", { username, password });

        const KEY = "loginData";
        if(!localStorage.getItem(KEY)) {
            let loginData = {
                usernames: [username],
                passwords: [password]
            };
            localStorage.setItem(KEY, JSON.stringify(loginData));
            sessionStorage.setItem('currentUser', username);
            alert("Registration successful!");
            window.location.href = 'pages/home.html';
            return;
        } else {
            let loginData = JSON.parse(localStorage.getItem(KEY));
            if(loginData.usernames.includes(username) && !(loginData.passwords[loginData.usernames.indexOf(username)] === password)) {
                alert("Username already exists. Please choose a different username, or try logging in if this is your account.");
                return;
            } else {
                if(loginData.usernames.includes(username) && loginData.passwords[loginData.usernames.indexOf(username)] === password) {
                    sessionStorage.setItem('currentUser', username);
                    alert("Login successful!");
                    window.location.href = 'pages/home.html';
                    return;
                }
            }

            loginData.usernames.push(username);
            loginData.passwords.push(password);
            localStorage.setItem(KEY, JSON.stringify(loginData));
            sessionStorage.setItem('currentUser', username);
            alert("Registration successful!");
            window.location.href = 'pages/home.html';
        }
    }

    loginForm.addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the default form submission

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        saveLoginData(username, password);
    });

    loginFormInputs.forEach(input => {
        input.addEventListener('input', function() {
            const iconInput = input.closest('.icon-input');
            if(validateInput(input)) {
                if(input.checkValidity()) {
                    iconInput.classList.remove('input-error');
                } else {
                    iconInput.classList.add('input-error');
                }
            } else {
                iconInput.classList.remove('input-error');
            }
        });

        input.addEventListener('blur', function() {
            const iconInput = input.closest('.icon-input');
            if(validateInput(input)) {
                iconInput.classList.remove('input-error');
            } else {
                iconInput.classList.add('input-error');
            }
        });
    });
</script>
</html>